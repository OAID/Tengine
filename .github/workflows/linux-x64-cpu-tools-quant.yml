name: linux-x64-cpu-tools-quant

on:
  push:
    branches: [tengine-lite]
    paths:
    paths-ignore: 
    - 'doc/**'
    - 'README.md'
    - 'README_EN.md'
  pull_request:
    branches: [tengine-lite]
    paths-ignore: 
    - 'doc/**'
    - 'README.md'
    - 'README_EN.md'

jobs:
  linux-x64-cpu-tools-quant:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2.3.4
    - uses: "marvinpinto/action-automatic-releases@latest"
      with:
        repo_token: "${{ secrets.GITHUB_TOKEN }}"
        automatic_release_tag: "latest"
        prerelease: true
        title: "Development Build"
        files: |
          logo-Tengine.png
    - name: Build AppImage
      run: |
        docker run --network=host --env PROTOBUF_REPO_DIR=$PWD/protobuf -v $PWD:$PWD -w $PWD --privileged --ipc=host centos:7 $PWD/.github/workflows/build-quant-tool-appimage.sh
    # - name: update
    #   run: sudo apt-get update
    # - name: opencv
    #   run: sudo apt-get install libopencv-dev
    # - name: configure
    #   run: mkdir build && cd build && cmake -DTENGINE_BUILD_EXAMPLES=ON ..
    # - name: build
    #   run: cmake --build build -j 2
    # - name: depends
    #   run: |
    #     git clone https://github.com/BUG1989/tengine_test_data.git
    #     cp ./tengine_test_data/mobilenet.tmfile ./
    #     cp -rf ./tengine_test_data/dataset ./
    #     wget ftp://219.139.34.182/tengine/ci_test/images.zip
    #     unzip images.zip
    # - name: quant-tools-test
    #   run: |
    #     ./quant_tool_uint8-x86_64.AppImage -m mobilenet.tmfile -o mobilenet_uint8.tmfile -i ./dataset -g 3,224,224 -s 0.017,0.017,0.017 -c 1
    # - name: uint8-model-test
    #   run: |
    #     cd build
    #     ./examples/tm_classification_uint8 -m mobilenet_uint8.tmfile -i images/cat.jpg -g 224,224 -s 0.017,0.017,0.017
    - uses: "marvinpinto/action-automatic-releases@latest"
      with:
        repo_token: "${{ secrets.GITHUB_TOKEN }}"
        automatic_release_tag: "latest"
        prerelease: true
        title: "Development Build"
        files: |
          *.AppImage

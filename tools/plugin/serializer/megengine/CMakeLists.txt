
set(SERIALIZER_TARGET megengine-serializer)

FILE(GLOB_RECURSE MEGENGINE_SRCS "*.cpp")

ADD_LIBRARY(${SERIALIZER_TARGET} SHARED ${MEGENGINE_SRCS})

include_directories(${MEGENGINE_INSTALL_PATH}/include)

#link libmegengine
find_library(MEGENGINE_LIB NAMES megengine dnnl flatbuffers PATHS ${MEGENGINE_INSTALL_PATH}/lib)
find_library(DNNL_LIB NAMES dnnl PATHS ${MEGENGINE_INSTALL_PATH}/lib)
find_library(FLATBUFFERS_LIB NAMES flatbuffers PATHS ${MEGENGINE_INSTALL_PATH}/lib)

target_link_libraries(${SERIALIZER_TARGET} ${MEGENGINE_LIB} ${DNNL_LIB} ${FLATBUFFERS_LIB})

SET_TARGET_PROPERTIES(${SERIALIZER_TARGET} PROPERTIES VERSION ${SERIALIZER_VERSION} SOVERSION ${SERIALIZER_SO_VERSION})

install(TARGETS ${SERIALIZER_TARGET} DESTINATION lib)

#below is for static library

ADD_LIBRARY(${SERIALIZER_TARGET}-static STATIC ${MEGENGINE_SRCS})
SET_TARGET_PROPERTIES(${SERIALIZER_TARGET}-static PROPERTIES OUTPUT_NAME  ${SERIALIZER_TARGET})

ADD_DEPENDENCIES(${SERIALIZER_TARGET} ${SERIALIZER_TARGET}-static)

install(TARGETS ${SERIALIZER_TARGET}-static DESTINATION lib)
